datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String
  contactInfo   String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  createdMinors MinorProfile[] @relation("CreatedBy")
  enrollments   Participant[]  @relation("EnrolledBy")
  participations Participant[] @relation("SelfParticipant")
}

model MinorProfile {
  id              String        @id @default(cuid())
  fullName        String
  dateOfBirth     DateTime
  gender          String?
  schoolName      String
  className       String?
  nationalId      String?
  studentNumber   String?
  createdBy       User          @relation("CreatedBy", fields: [createdByUserId], references: [id])
  createdByUserId String
  participants    Participant[]
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model OlympiadEdition {
  id               String        @id @default(cuid())
  name             String
  year             Int
  enrollmentStart  DateTime
  enrollmentEnd    DateTime
  status           String        @default("DRAFT") // DRAFT, OPEN, RUNNING, COMPLETED
  participants     Participant[]
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
}

model Participant {
  id                String    @id @default(cuid())
  participantType   String    // SELF or MINOR
  edition           OlympiadEdition @relation(fields: [editionId], references: [id])
  editionId         String
  user              User?     @relation("SelfParticipant", fields: [userId], references: [id])
  userId            String?
  minorProfile      MinorProfile? @relation(fields: [minorProfileId], references: [id])
  minorProfileId    String?
  enrolledBy        User      @relation("EnrolledBy", fields: [enrolledByUserId], references: [id])
  enrolledByUserId  String
  educationLevel    String    // Primary, O'Level, A'Level
  status            String    @default("ACTIVE") // ACTIVE, DISQUALİFİED, WITHDRAWN, COMPLETED
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}
